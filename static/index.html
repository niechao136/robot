<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>AI数字人模拟面试机器人</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bodymovin/5.10.1/lottie.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/microsoft-cognitiveservices-speech-sdk@latest/distrib/browser/microsoft.cognitiveservices.speech.sdk.bundle-min.js"></script>
<style>
    body {
        text-align: center;
        background: url('./img/background.png') no-repeat center center fixed;
        background-size: cover;
        color: white;
        font-family: '楷体', KaiTi, serif;
    }
    #lottieContainer { width: 300px; height: 300px; margin: 20px auto; }
    #userSendArea { margin-top: 20px; }
    .responseText { border: 1px solid #ccc; padding: 10px; margin-top: 10px; background-color: #f9f9f9; color: black; }
</style>
</head>
<body>
<h1>欢迎来到智泊AI数字人模拟面试现场</h1>
<div id="lottieContainer"></div>
<div id="responseArea"></div>
<div id="userSendArea">
    <input type="text" id="chatInput" placeholder="请输入你的问题" style="width:300px;height:30px;">
    <select id="voiceSelect" style="width:120px;height:30px;">
        <option value="zh-CN-XiaoxiaoNeural" selected>中文普通话</option>
        <option value="zh-HK-HiuMaanNeural">中文粤语</option>
        <option value="zh-TW-HsiaoChenNeural">中文台湾</option>
    </select>
    <button id="sendBtn" style="width:80px;height:30px;">发送</button>
</div>
<audio id="ttsAudio"></audio>

<script>
const lottieContainer = document.getElementById('lottieContainer');
const animation = lottie.loadAnimation({
    container: lottieContainer,
    renderer: 'svg',
    loop: true,
    autoplay: false,
    path: 'avatar.json' // 替换为你的Lottie动画JSON
});

const subscriptionKey = "4Bnr4BTLCl1teBJJ2OxCmDlHrXCUDlloHGWQMBnc3rbAFapoujcWJQQJ99BHACYeBjFXJ3w3AAAYACOG7q9j";
const region = "eastus";
const chatInput = document.getElementById('chatInput');
const sendBtn = document.getElementById('sendBtn');
const ttsAudio = document.getElementById('ttsAudio');
const responseArea = document.getElementById('responseArea');
const voiceSelect = document.getElementById('voiceSelect');

// 初始化 TTS
const speechConfig = SpeechSDK.SpeechConfig.fromSubscription(subscriptionKey, region);
speechConfig.speechSynthesisLanguage = "zh-CN";

// 发送消息
sendBtn.onclick = async () => {
    const query = chatInput.value.trim();
    if (!query) return;

    // 显示用户输入
    responseArea.innerHTML = `<div class="responseText">你: ${query}</div>`;

    // 调用AI接口获取回复
    const res = await fetch('http://150.109.15.178:10082/chat', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({query})
    });
    const data = await res.json();
    const aiText = Array.isArray(data) && data[0]?.msg ? data[0].msg : "抱歉，我暂时无法回答。";
    const emotion = Array.isArray(data) && data[0]?.qingxu ? data[0].qingxu : "default";

    // 显示AI文本
    responseArea.innerHTML += `<div class="responseText">AI: ${aiText}</div>`;

    // 开始嘴型动画
    animation.play();

    // 创建语音合成器并播放
    const audioConfig = SpeechSDK.AudioConfig.fromDefaultSpeakerOutput();
    speechConfig.speechSynthesisVoiceName = voiceSelect.value;
    const synthesizer = new SpeechSDK.SpeechSynthesizer(speechConfig, audioConfig);
    synthesizer.speakTextAsync(aiText,
        result => {
            console.log("TTS完成:", result);
            animation.stop();
            synthesizer.close();
        },
        error => {
            console.error(error);
            animation.stop();
            synthesizer.close();
        }
    );

    chatInput.value = "";
};
</script>
</body>
</html>
